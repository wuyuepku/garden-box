# garden-box
the smart garden project, interactive box which has LEDs and measures data

## Design

宿舍区智能花园里放置40cm立方的水泥箱，其中种植各类植物。本项目旨在提供交互式体验，表现在

- 环形全彩LED在顶部一圈，可以根据场景表现不同的效果
- 土壤湿度监测
- 空气环境监测（待定）

### 细节设计——LED

使用60颗/m的灯条，每个箱子上的大约成本为30元左右，滴胶或套管做防尘防水。

每颗灯珠可以独立控制

### 细节设计——土壤湿度监测

购买模块，输入模拟型号进行监测，时间间隔可以远程设定，默认值为60s

### 细节设计——控制系统

每个box上面需要有一个嵌入式系统，综合功能性和成本考虑，决定使用ESP8266单片机，通过WIFI连接到室外路由器。为了日常监控方便，日常报告RSSI到远程服务器，比如1小时报告一次

#### 通信协议

使用MQTT，基于TCP socket，但封装了包和topic，更方便管理。

#### 通用性设计

抽象需要实现的功能，将可编程性体现在参数的改变上，比如LED灯的模式，其实用户看起来就是每一帧怎么变化的，那么产生这样一个数组，比如100颗灯珠的情况，存储60帧需要60×100×3=18K的空间，用户看不见闪烁即可，那么一秒20帧左右足以。比如留出100K的Flash空间（**注意不是RAM**，arduino给了EEPROM的读写例程）给这个数组，每次load一帧到内存，就可以实现想要的各种功能了，相比于更新程序本身，这个方案浪费更新时的数据带宽，但更加robust，更便于调试（调试时编程语言无关）

### 细节设计——更新与调试

对于一个产品化的嵌入式系统，如何更新应用程序是一个需要重点考虑的问题，毕竟实际部署后再想更新程序，就需要大量的人力物力成本。从两个方面保证系统的可用性：

#### 1. 调试的便捷性

在部署前一定要进行调试，调试的内容需要提前设计好，限制调试的内容。比如LED，一般来说，只需要更新它的模式，那么找到一种通用的表示方式，然后通过软件更新去加载最新的程序即可

本地调试时需要有不涉及硬件的解决方案，这个项目里附带一个python程序来供调试

#### 2. 更新的便捷性

通过MQTT的topic发布，设备监听更新topic，并且更新后发布自己的版本号，方便服务器端统一监管

